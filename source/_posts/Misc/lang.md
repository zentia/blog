---
title: 多语言规范
date: 2017-10-25 11:05:45
tags:
  - sy
---

# 概述部分
多语言资源，客户端和服务器放在不同目录里，公用的部分使用外链。

客户端多语言根目录：Assets\Art\lang
二级目录mb：存放mb的多语言数据
二级目录res: 存放界面文本，以及其它资源的多语言数据（比如图片和prefab等）
三级目录：用各种语言名字来命令的目录
config.txt：保存当前语言的名字

服务器多语言根目录：bin\data\lang
二级目录mb：存放mb的多语言数据（这个是上面的客户端二级mb的外链）
二级目录mbs：存放mbs多语言数据
三级目录：用各种语言名字来命名的目录
config.txt：保存当前语言的名字（服务器和客户端需要分别配置）

## 程序需要做的事情:：
1. 处理表格配置，合理设置翻译列；
2. 在界面prefab里，给UILabel等控件填写langId，需要同时创建对应的文字资源文件；
3. 界面用到的Lua/text里的json文件，需要转换成txt文件资源；
4. 脚本里的中文，需要放到文本资源里；
5. 图片文字，需要整理放到单独目录里，便于提供海外运营商；

# res目录规范
此目录是界面文本资源表格，表格无标题行，分三列：名字，文本，英文长度，某些按钮类的空间，如果需要限制文本长度，那么需要填写英文长度列。
不要有任何子目录，子目录是无效的。
非翻译文本（比如目录配置文本），放到lua里就好，不要放在txt里。
此目录里的所有文件，都是用到的时候加载的
文本资源使用方式：
- C#代码访问方式：LangMgr.Find("login.Username"),此函数无GC
- prefab访问方式：填写UILabel的langId,格式同上，所有中文标签都要做修改。
- lua脚本访问方式：lua_core.LoadLangFile("login").Username
目录file：
可替换掉相同路径的资源，比如字体替换，文字图片替换等，也可以直接用这个替换整个界面的prefab，但是轻易不要这样用。

## Json转Text工具
在Unity里，选中Lua/text/目录里的某个文件
点击菜单项Pangmei/Translate/json转text，这样可以将原本的json文件转txt表格。
转换后的文件放在了Assets\Art\lang\res\zh_cn\text\temp里，需要重新命名后挪出来。
原本的子目录都不要有了，如果有重命名，就自己改个名字。
建议文件别太多，太小的文件自己合并一下，文件少会更容易管理。
## 新文本merge方式
可以使用string.merge()来格式化字符串，这个是仿造C#的Format来设计功能。用{0}引用首个参数，其余参数类推。这个函数在客户端没有C#级别的GCAlloc，大量使用的时候推荐这个，不要用CSFormat系列了。
部分带%s的文本，建议都检查一下，多个%s的文本有可能会导致某些语言翻译错误（主谓宾和汉语次序不同导致）
# mb目录规范
## 翻译列配置
表格的json配置文件，每列可以加防疫配置"translate":true
指定翻译的列：会被翻译工具检索出来生成翻译词条。
## 目录text
有工具生成的表格翻译文本，运行期动态替换掉中文表格文本。
## 目录cell
替换掉同名表格指定单元格的内容，不需要写子目录。
多个文件可以同名，以二级扩展名区分，比如：item_list.a.txt,item_list.b.txt
同名文件按照二级扩展名排序依次执行，重复配置的单元格，以最后的为准。
首行是标题，第二行是json配置里的表格列的名字，后续航是替换的内容。
第二行的名字，可以不填写，就表示忽略该列。此特性通常用于注释或者名字之类的。
空单元格表示不需要替换，如果需要替换为空，那么填写“##”
## 目录file
整文件替换表格，对应的参照目录是mb目录。
这个功能尽量别用，使用cell来精确替换某个单元格更可控。
# mbs目录规范
## 翻译列配置：
规则同mb
## 目录text
规则同mb
## 目录cell
基本规则同mb
有子目录npc_refresh和flag，分别对应那两组表，目录内的规则也同mb
## 目录file
规则同mb
# 翻译工具
海外专员翻译工具路径：
svn://zentia/welcome/LangTool
海外专员一般是市场部同学。
负责将待翻译的文本到处，然后发给海外运营商翻译，并且将译文导入公用词条库里。
## 项目分支翻译工具路径：
svn://zentia/trunk/xxpub/LangTool（其余分支路径类似）
项目的导入职能由产品负责
需要在每个海外版本发布前，将特定分支生成海外文本资源并且上传。
# 多语言名字参照
微软的多语言名称参考网站：https://www.microsoft.com/en-us/locale.aspx